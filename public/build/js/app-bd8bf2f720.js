document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("categorias-btn"),t=document.getElementById("categorias-modal"),o=document.querySelector(".close");if(e&&t&&o){function n(){document.body.style.overflow=""}t.classList.remove("show"),e.addEventListener("click",(()=>{t.classList.add("show"),document.body.style.overflow="hidden"})),o.addEventListener("click",(()=>{t.classList.remove("show"),n()})),window.addEventListener("click",(e=>{e.target===t&&(t.classList.remove("show"),n())}))}const a=document.querySelector(".dropdown");if(a){a.querySelector(".dropdown__boton").addEventListener("click",(e=>{e.stopPropagation(),a.classList.toggle("mostrar")})),window.addEventListener("click",(e=>{a.contains(e.target)||a.classList.remove("mostrar")}))}const r=document.querySelectorAll(".contador");if(r.length>0){const u=e=>{const t=parseInt(e.dataset.target,10);let o=0;const n=t/31.25,a=()=>{o+=n,o>=t?e.innerText=`+${t}`:(e.innerText=`+${Math.floor(o)}`,requestAnimationFrame(a))};a()},f=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.classList.remove("animado"),e.target.innerText="+0",u(e.target))}))}),{threshold:.3});r.forEach((e=>f.observe(e))),window.addEventListener("load",(()=>{r.forEach((e=>{e.classList.contains("animado")||u(e)}))}))}const s=document.querySelector(".dashboard__mobile-menu"),i=document.querySelector(".dashboard__sidebar");s&&i&&(s.addEventListener("click",(function(){i.classList.toggle("sidebar--mostrar")})),document.body.addEventListener("click",(function(e){i.contains(e.target)||s.contains(e.target)||i.classList.remove("sidebar--mostrar")}))),document.querySelectorAll(".favorito-btn").forEach((e=>{e.addEventListener("click",(async t=>{if(t.preventDefault(),this.disabled)return;const o=e.dataset.productoId,n=e.querySelector("i");try{const e=await fetch("/favoritos/toggle",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`productoId=${encodeURIComponent(o)}`}),t=await e.json();if(!e.ok)throw new Error(t.error||"Error en la solicitud");n.classList.toggle("fa-regular"),n.classList.toggle("fa-solid");const a=document.querySelector(".alert-notification");a&&a.remove();const r="added"===t.action?'<i class="fas fa-check-circle"></i> Agregado a favoritos':'<i class="fas fa-trash-alt"></i> Eliminado de favoritos',s=document.createElement("div");s.className="alert-notification",s.innerHTML=r,s.style.backgroundColor="added"===t.action?"#4CAF50":"#f44336",document.body.appendChild(s),setTimeout((()=>{s.style.opacity="0",setTimeout((()=>s.remove()),300)}),2500)}catch(e){console.error("Error:",e),alert(e.message)}}))})),document.body.addEventListener("click",(async function(e){if(e.target.closest(".no-interesa-btn")){const t=e.target.closest(".no-interesa-btn"),o=t.dataset.productoId;try{const e=await fetch("/api/productos/no-interesa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productoId:o})}),n=await e.json();if(n.success){const e=t.closest('.producto[data-producto-card-id="'+o+'"]');e&&(e.style.transition="opacity 0.5s ease",e.style.opacity="0",setTimeout((()=>e.remove()),500))}else alert("Error: "+n.error)}catch(e){console.error("Error:",e),alert("No se pudo completar la acción.")}}}));const c=document.getElementById("modal-reporte-valoracion");if(!c)return;const l=document.getElementById("form-reporte-valoracion"),d=c.querySelector(".modal-reporte__cerrar"),A=document.getElementById("reporte-valoracion-id");document.body.addEventListener("click",(function(e){if(e.target.closest(".reportar-btn")){const t=e.target.closest(".reportar-btn").dataset.valoracionId;A.value=t,c.style.display="flex"}})),d.onclick=()=>{c.style.display="none"},window.onclick=e=>{e.target===c&&(c.style.display="none")},l.addEventListener("submit",(async function(e){e.preventDefault();const t=new FormData(this),o=Object.fromEntries(t.entries());try{const e=await fetch("/valoraciones/reportar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.json();alert(t.message||t.error),e.ok&&(c.style.display="none",l.reset())}catch(e){alert("Error al conectar con el servidor. Inténtalo de nuevo.")}}))})),function(e,t){function o(e,t){return typeof e===t}function n(e){var t=d.className,o=c._config.classPrefix||"";if(A&&(t=t.baseVal),c._config.enableJSClass){var n=new RegExp("(^|\\s)"+o+"no-js(\\s|$)");t=t.replace(n,"$1"+o+"js$2")}c._config.enableClasses&&(t+=" "+o+e.join(" "+o),A?d.className.baseVal=t:d.className=t)}function a(e,t){if("object"==typeof e)for(var o in e)l(e,o)&&a(o,e[o]);else{var r=(e=e.toLowerCase()).split("."),s=c[r[0]];if(2==r.length&&(s=s[r[1]]),void 0!==s)return c;t="function"==typeof t?t():t,1==r.length?c[r[0]]=t:(!c[r[0]]||c[r[0]]instanceof Boolean||(c[r[0]]=new Boolean(c[r[0]])),c[r[0]][r[1]]=t),n([(t&&0!=t?"":"no-")+r.join("-")]),c._trigger(e,t)}return c}var r=[],s=[],i={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var o=this;setTimeout((function(){t(o[e])}),0)},addTest:function(e,t,o){s.push({name:e,fn:t,options:o})},addAsyncTest:function(e){s.push({name:null,fn:e})}},c=function(){};c.prototype=i,c=new c;var l,d=t.documentElement,A="svg"===d.nodeName.toLowerCase();!function(){var e={}.hasOwnProperty;l=o(e,"undefined")||o(e.call,"undefined")?function(e,t){return t in e&&o(e.constructor.prototype[t],"undefined")}:function(t,o){return e.call(t,o)}}(),i._l={},i.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),c.hasOwnProperty(e)&&setTimeout((function(){c._trigger(e,c[e])}),0)},i._trigger=function(e,t){if(this._l[e]){var o=this._l[e];setTimeout((function(){var e;for(e=0;e<o.length;e++)(0,o[e])(t)}),0),delete this._l[e]}},c._q.push((function(){i.addTest=a})),c.addAsyncTest((function(){function e(e,t,o){function n(t){var n=!(!t||"load"!==t.type)&&1==r.width;a(e,"webp"===e&&n?new Boolean(n):n),o&&o(t)}var r=new Image;r.onerror=n,r.onload=n,r.src=t}var t=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],o=t.shift();e(o.name,o.uri,(function(o){if(o&&"load"===o.type)for(var n=0;n<t.length;n++)e(t[n].name,t[n].uri)}))})),function(){var e,t,n,a,i,l;for(var d in s)if(s.hasOwnProperty(d)){if(e=[],(t=s[d]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(a=o(t.fn,"function")?t.fn():t.fn,i=0;i<e.length;i++)1===(l=e[i].split(".")).length?c[l[0]]=a:(!c[l[0]]||c[l[0]]instanceof Boolean||(c[l[0]]=new Boolean(c[l[0]])),c[l[0]][l[1]]=a),r.push((a?"":"no-")+l.join("-"))}}(),n(r),delete i.addTest,delete i.addAsyncTest;for(var u=0;u<c._q.length;u++)c._q[u]();e.Modernizr=c}(window,document);